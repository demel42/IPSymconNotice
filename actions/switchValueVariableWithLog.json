{
  "id": "{E9CC54F3-19B5-E3E2-B6BC-A02065C1FC85}",
  "caption": "Switch to Value of other Variable with log",
  "form": [
    "$variable = IPS_GetVariable($_IPS['TARGET']);",
    "$types = [];",
    "if ($variable['VariableType'] === 2) {",
    "    $types = [1, 2];",
    "}",
    "else {",
    "    $types = [ $variable['VariableType'] ];",
    "}",
    "$noticeBases = IPS_GetInstanceListByModuleID('{4CF21C1E-B0F8-5535-8B5D-01ADDDB5DFD7}');",
    "return [",
    "   [",
    "       'type' => 'SelectVariable',",
    "       'name' => 'VARIABLE',",
    "       'caption' => 'Variable',",
    "       'validVariableTypes' => $types",
    "   ],",
    "   [",
    "       'type' => 'SelectInstance',",
    "       'validModules' => ['{4CF21C1E-B0F8-5535-8B5D-01ADDDB5DFD7}'],",
    "       'name' => 'NOTICE_BASE',",
    "       'value' => isset($noticeBases[0]) ? $noticeBases[0] : 0,",
    "       'caption' => 'Notice base',",
    "   ],",
    "   [",
    "       'type' => 'ValidationTextBox',",
    "       'name' => 'SUCCEED_LOG',",
    "       'width' => '80%',",
    "       'value' => '{NAME} ({LOCATION1}) set to {VALUE}',",
    "       'caption' => 'Log in case of success',",
    "   ],",
    "   [",
    "       'type' => 'ValidationTextBox',",
    "       'name' => 'FAILURE_LOG',",
    "       'width' => '80%',",
    "       'value' => 'Failure: unable to set {NAME} ({LOCATION1}) to {VALUE}',",
    "       'caption' => 'Log in case of failure',",
    "   ]",
    "];"
  ],
  "action": [
    "$r = RequestAction($_IPS['TARGET'], GetValue($_IPS['VARIABLE']));",
    "$pat = [];",
    "$sub = [];",
    "$pat[] = '/{VALUE}/';",
    "$value = @GetValueFormatted($_IPS['TARGET']);",
    "if ($value == '') {",
    "    $value = GetValue($_IPS['VARIABLE']);",
    "}",
    "$sub[] = $value;",
    "$pat[] = '/{NAME}/';",
    "$sub[] = IPS_GetName($_IPS['TARGET']);",
    "$pat[] = '/{LOCATION}/';",
    "$sub[] = IPS_GetLocation($_IPS['TARGET']);",
    "$locS = explode(chr(0x5C), IPS_GetLocation($_IPS['TARGET']));",
    "for ($n = 0, $i = count($locS) - 1; $i >= 0; $n++, $i--) {",
    "    $pat[] = '/{LOCATION' . $n . '}/';",
    "    $sub[] = $locS[$i];",
    "}",
    "$msg = $_IPS[$r ? 'SUCCEED_LOG' : 'FAILURE_LOG'];",
    "$msg = preg_replace($pat, $sub, $msg);",
	"if (IPS_InstanceExists($_IPS['NOTICE_BASE'])) {",
    "    Notice_Log($_IPS['NOTICE_BASE'], $msg, $r ? 'info' : 'warn', []);",
    "} else {",
	"    IPS_LogMessage($_IPS['SELF'], $msg);",
    "}"
  ],
  "restrictions": {
    "objectType": [
      2
    ],
    "requestAction": true
  },
  "locale": {
    "de": {
      "Switch to Value of other Variable with log": "Schalte auf Wert einer anderen Variablen mit Protokoll",
      "Variable": "Variable",
      "Switch to value of {VARIABLE, object}": "Schalte auf Wert von {VARIABLE, object}",
      "Switch the target variable to the value of another variable with log": "Schalte die Zielvariable auf den Wert einer anderen Variablen mit Protokoll",
      "Notice base": "Mitteilungs-Basis",
      "Log in case of success": "Log im Erfolgsfall",
      "Log in case of failure": "Log im Fehlerfall",
      "{NAME} ({LOCATION1}) set to {VALUE}": "{NAME} ({LOCATION1}) wurde auf {VALUE} gesetzt",
      "Failure: unable to set {NAME} ({LOCATION1}) to {VALUE}": "Failure: {NAME} ({LOCATION1}) kann nicht auf {VALUE} gesetzt werden"
    }
  },
  "format": "Switch to value of {VARIABLE, object}",
  "category": "switch",
  "description": "Switch the target variable to the value of another variable with log"
}
